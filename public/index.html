<!DOCTYPE html>
<html>
    <head>
        <title>Passive Packet Visualiser</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.19.1/vis.min.js" type="text/javascript"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.19.1/vis.min.css" />
        <style>html,body{margin:0;padding:0;height:100%;overflow:hidden;}#network{height:100%;background-color:#333333;}</style>
    </head>
    <body>
        <div id="network"></div>
        <script>
            window.onload = function () {
                var nodeList = [], edgesList = [];
                var nodes = new vis.DataSet([]);
                var edges = new vis.DataSet([]);
                var network = new vis.Network(document.getElementById('network'), {nodes:nodes,edges:edges}, {});

                function randomId() { return (Math.random() * 1e7).toString(32); }

                var request = new XMLHttpRequest();
                request.onreadystatechange = function() {
                     if (request.readyState == 4 && request.status == 200) {
                        var data = JSON.parse(request.responseText);

                        data.forEach(function(item) {
                            var record = JSON.parse(item);
                            var src = record['src'];
                            var dst = record['dst'];

                            if(!(src in nodeList)) {
                                var id = randomId();
                                nodes.add({id:id, label:src});
                                nodeList[src] = id;
                            }
                            if(!(dst in nodeList)) {
                                var id = randomId();
                                nodes.add({id:id, label:dst});
                                nodeList[dst] = id;
                            }

                            var src_id = nodeList[src];
                            var dst_id = nodeList[dst];

                            if(!(src_id in edgesList)) edgesList[src_id] = [];

                            if(!edgesList[src_id].includes(dst_id)) {
                                edges.add({
                                    "id": randomId(),
                                    "from": src_id,
                                    "to": dst_id,
                                    "arrows": "to",
                                });
                                edgesList[src_id].push(dst_id);
                            }
                        });
                        network.fit();
                     }
                  }
                request.open('GET', '/data', true);
                request.send();
            };
        </script>
    </body>
</html>